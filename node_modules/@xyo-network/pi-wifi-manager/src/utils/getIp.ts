import { first, flatMap, get } from 'lodash'
import os from 'os'

const isValidIPv4 = (iface: unknown) => !get(iface, 'internal') && get(iface, 'family') === 'IPv4'

export default (): string | null | undefined => {
  const interfaces = os.networkInterfaces()
  const flatInterfaces = flatMap(Object.keys(interfaces).map(name => interfaces[ name ] || []))
  const ips = flatInterfaces.filter(isValidIPv4).map((iface: unknown) => get(iface, 'address'))
  return first(ips)
}
