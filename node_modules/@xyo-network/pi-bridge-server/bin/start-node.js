#!/usr/bin/env node

// tslint:disable

const { BridgeServer } = require('../dist/index.js');
const { NodeWifiManager } = require('@xyo-network/pi-wifi-manager');
const { BridgeConfigurationManager } = require('@xyo-network/bridge-configuration');

function main() {
  const port = Number(process.env.PORT) || 13000
  const configuration = new BridgeConfigurationManager()
  const wifi = new NodeWifiManager()

  // if (!process.env.SKIP_BLE) {
  //   console.log('Starting bridge discovery')
  //   const { startBleServices, NetworkService } = require('@xyo-network/bridge-ble');
  //   const networkService = new NetworkService(wifi)
  //   networkService.start()
  //   startBleServices('XYO Bridge', [
  //     networkService
  //   ])
  // }

  const server = new BridgeServer({
    port,
    wifi,
    configuration
  });
  server.start(() => {
    console.log('Running', server.context.port)
  })
}

main()
