"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const bleno_1 = require("@xyo-network/bleno");
const options_1 = require("./options");
const debug_1 = __importDefault(require("debug"));
exports.createNotifyCharacteristic = ({ uuid, name }, subscribe, logger = debug_1.default('bleno:notify')) => {
    let unsubscribe = () => null;
    const options = options_1.createNotifyOptions({ uuid, name });
    options.onSubscribe = (maxValueSize, fn) => {
        logger(`Subscribed ${name}`, `maxValueSize=${maxValueSize}`);
        unsubscribe = subscribe((result) => {
            try {
                const str = typeof result === 'string' ? result : '';
                logger(`Notify ${name}`, `result=${str}`, Buffer.from(str).length, Buffer.from(str).byteLength);
                fn(Buffer.from(str));
            }
            catch (e) {
                console.log(e);
            }
        });
    };
    options.onUnsubscribe = () => {
        logger(`Unsubscribed ${name}`);
        unsubscribe();
    };
    const characteristic = new bleno_1.Characteristic(options);
    return characteristic;
};
//# sourceMappingURL=create.js.map