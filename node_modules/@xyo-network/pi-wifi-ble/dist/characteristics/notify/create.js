"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createNotifyCharacteristic = void 0;
const bleno_1 = require("@abandonware/bleno");
const debug_1 = __importDefault(require("debug"));
const options_1 = require("./options");
const createNotifyCharacteristic = ({ uuid, name }, subscribe, logger = (0, debug_1.default)('bleno:notify')) => {
    let unsubscribe = () => null;
    const options = (0, options_1.createNotifyOptions)({ uuid, name });
    options.onSubscribe = (maxValueSize, fn) => {
        logger(`Subscribed ${name}`, `maxValueSize=${maxValueSize}`);
        unsubscribe = subscribe((result) => {
            try {
                const str = typeof result === 'string' ? result : '';
                logger(`Notify ${name}`, `result=${str}`, Buffer.from(str).length, Buffer.from(str).byteLength);
                fn(Buffer.from(str));
            }
            catch (e) {
                console.log(e);
            }
        });
    };
    options.onUnsubscribe = () => {
        logger(`Unsubscribed ${name}`);
        unsubscribe();
    };
    const characteristic = new bleno_1.Characteristic(options);
    return characteristic;
};
exports.createNotifyCharacteristic = createNotifyCharacteristic;
//# sourceMappingURL=create.js.map